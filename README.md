# Contentful Migration Docker Image

This project contains the dockerfile used for the Contentful migration tool Docker image.

## Requirements

To run the Docker image locally or in a build pipeline, Docker is required.

## Usage

In order to pull the image, run:

```
docker pull dfdsdk/contentful-migration:tagname
```
Replace tagname with the release number of the release you wish to pull.
Releases can be found on [Docker Hub](https://hub.docker.com/r/dfdsdk/contentful-migration/tags).


You need to mount the folder that contains the source code with the migration scripts. 
The scripts make some assumptions on how the folders supposed to be organized:

* migration\contentTypes 
Contains the json files of the content types that are exported from the Contentful space. These files are used as a base by the migration system so it can work propperly. Therefore they should be exported from Contentful space /environment when it's in a valid state.

* migration\migrations
Contains the migration scripts that are generated by the migration scripts (the diff files). These will be used by to apply changes on the target Contentful space.

Running the docker:

Create the diff file for new content type "my-new-type" created in dev space:
```
docker run -it -v C:\Repos\migration_tool\:/migration -e CONTENTFUL_SPACE_ID=xxxxxxxxxxx -e ENVIRONMENT_ID=dev -w="/migration" --entrypoint "/bin/bash" dfdsdk/contentful-migration:latest create-migration.sh --ct_type_id=my-new-type --mgmnt_token=xxxxxxxxxxxx
```

Apply the new content type "my-new-type" in the target space staging:
```
docker run -it -v  C:\Repos\migration_tool\:/migration -e CONTENTFUL_SPACE_ID=xxxxxxxxxxx -w="/migration" --entrypoint "/bin/bash" dfdsdk/contentful-migration:latest apply-migrations.sh --env_id=test --mgmnt_token=xxxxxxxxxxxx
```
## Debugging

When troubleshooting Docker image layers, it can be useful to run a particular layer of the image (e.g. just before a step fails):

```console
docker run -it <layer> bash
```

## Contributing

1. Fork it!
2. Create your feature branch: `git checkout -b my-new-feature`
3. Commit your changes: `git commit -am 'Add some feature'`
4. Push to the branch: `git push origin my-new-feature`
5. Submit a pull request to merge with master

Whenever a new commit is submitted to master, a build is triggered in DockerHub.
After committing, make sure to make a new incremental release in github.

## License

MIT LICENSE
